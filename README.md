# FFmpeg Mac æ„å»ºå·¥å…· v2.0

ä¸€ä¸ªç”¨äºåœ¨ macOS ä¸Šè‡ªåŠ¨æ„å»º FFmpeg å¼€å‘ç¯å¢ƒçš„å·¥å…·ï¼Œæ”¯æŒå¢é‡æ„å»ºã€å¹¶è¡Œç¼–è¯‘å’Œç‰ˆæœ¬ç®¡ç†ã€‚

## ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [åŒ…å«çš„åº“](#åŒ…å«çš„åº“)
- [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- macOS 10.15+
- [Homebrew](https://brew.sh)
- Xcode Command Line Tools: `xcode-select --install`

### ä¸‰æ­¥æ„å»º

```bash
# 1. å…‹éš†å¹¶è¿›å…¥ç›®å½•
git clone <repository-url> && cd ffmpeg-build-mac

# 2. è¿è¡Œæ„å»ºï¼ˆè‡ªåŠ¨å®‰è£…ä¾èµ–ï¼‰
./build_mac.sh

# 3. è®¾ç½®ç¯å¢ƒå¹¶éªŒè¯
source ./env_setup.sh -t
ffmpeg -version
```

## æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ | v1.0 | v2.0 |
|------|------|------|------|
| ğŸš€ **å¢é‡æ„å»º** | åªé‡ç¼–è¯‘ä¿®æ”¹è¿‡çš„åº“ | âŒ | âœ… |
| âš¡ **å¹¶è¡Œç¼–è¯‘** | å¤šæ ¸å¹¶è¡ŒåŠ é€Ÿ | âŒ | âœ… æœ€é«˜4å€æé€Ÿ |
| ğŸ“¦ **ç‰ˆæœ¬ç®¡ç†** | ç¨³å®šç‰ˆ/å¼€å‘ç‰ˆåˆ‡æ¢ | âŒ | âœ… |
| ğŸ”§ **Debugæ”¯æŒ** | åŒ…å«è°ƒè¯•ç¬¦å· | âŒ | âœ… æ‰€æœ‰13ä¸ªåº“ |
| ğŸ§© **æ¨¡å—åŒ–** | ç‹¬ç«‹åº“è„šæœ¬ | âŒ | âœ… |

### æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | v1.0 | v2.0 (j4) | v2.0 (j8) |
|------|------|-----------|-----------|
| é¦–æ¬¡æ„å»º | 60åˆ†é’Ÿ | 25åˆ†é’Ÿ | 15åˆ†é’Ÿ |
| å¢é‡æ„å»º | 60åˆ†é’Ÿ | 5-10åˆ†é’Ÿ | 3-8åˆ†é’Ÿ |
| æ— å˜æ›´ | 60åˆ†é’Ÿ | 10ç§’ | 10ç§’ |

## ä½¿ç”¨æŒ‡å—

### åŸºæœ¬å‘½ä»¤

```bash
# æŸ¥çœ‹å¸®åŠ©
./build_mac.sh --help

# é»˜è®¤æ„å»ºï¼ˆå¹¶è¡Œ4ä»»åŠ¡ï¼‰
./build_mac.sh

# è‡ªå®šä¹‰å¹¶è¡Œæ•°
./build_mac.sh -j 8

# åªæ„å»ºç‰¹å®šåº“
./build_mac.sh -l x264 -l x265

# å¼ºåˆ¶é‡æ–°ç¼–è¯‘
./build_mac.sh -f

# æ¸…ç†æ„å»ºäº§ç‰©
./build_mac.sh -c build
```

### ç¯å¢ƒç®¡ç†

```bash
# ä¸´æ—¶è®¾ç½®ï¼ˆå½“å‰ç»ˆç«¯ï¼‰
source ./env_setup.sh -t

# æ°¸ä¹…è®¾ç½®ï¼ˆå†™å…¥shellé…ç½®ï¼‰
source ./env_setup.sh -p

# æŸ¥çœ‹å½“å‰ç¯å¢ƒ
./env_setup.sh --show
```

### ç‰ˆæœ¬æ§åˆ¶

ç¼–è¾‘ `config/versions.conf` åˆ‡æ¢ç‰ˆæœ¬ï¼š

```bash
# ä½¿ç”¨æœ€æ–°å¼€å‘ç‰ˆï¼ˆé»˜è®¤ï¼‰
BUILD_MODE="latest"

# åˆ‡æ¢åˆ°ç¨³å®šç‰ˆ
BUILD_MODE="stable"
X264_VERSION="stable"
X265_VERSION="3.5"
```

## åŒ…å«çš„åº“

### è§†é¢‘ç¼–ç å™¨
- **H.264**: x264, openh264
- **H.265/HEVC**: x265, kvazaar
- **VP8/VP9**: libvpx
- **AV1**: libaom, SVT-AV1, dav1d (è§£ç )

### éŸ³é¢‘ç¼–ç å™¨
- **AAC**: fdk-aac
- **MP3**: lame
- **Opus**: opus

### è§†é¢‘å¤„ç†
- **libplacebo**: GPUåŠ é€Ÿè§†é¢‘å¤„ç†

## é«˜çº§åŠŸèƒ½

### Debugæ„å»º

```bash
# æ„å»ºdebugç‰ˆæœ¬
./build_mac.sh -d

# è‡ªå®šä¹‰debugæ ‡å¿—
./build_mac.sh -d --debug-flags="-g -O1"

# ä½¿ç”¨lldbè°ƒè¯•
source ./env_setup.sh -t
lldb ./ffmpeg_build/bin/ffmpeg
```

### æ—¥å¿—ç®¡ç†

```bash
# ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶
./build_mac.sh --log-file=build.log

# è¯¦ç»†è¾“å‡º
./build_mac.sh -v

# å®‰é™æ¨¡å¼ï¼ˆä»…é”™è¯¯/è­¦å‘Šï¼‰
./build_mac.sh -q
```

### é¡¹ç›®ç»“æ„

```
ffmpeg-build-mac/
â”œâ”€â”€ build_mac.sh              # ä¸»æ„å»ºè„šæœ¬
â”œâ”€â”€ env_setup.sh              # ç¯å¢ƒé…ç½®è„šæœ¬
â”œâ”€â”€ config/
â”‚   â””â”€â”€ versions.conf         # ç‰ˆæœ¬ç®¡ç†
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ common.sh             # é€šç”¨å‡½æ•°
â”‚   â”œâ”€â”€ config.sh             # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ logging.sh            # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ args.sh               # å‚æ•°è§£æ
â”‚   â”œâ”€â”€ parallel_builder.sh   # å¹¶è¡Œè°ƒåº¦
â”‚   â””â”€â”€ libs/                 # å„åº“æ„å»ºè„šæœ¬
â”œâ”€â”€ ffmpeg_sources/           # æºç ï¼ˆæ„å»ºæ—¶åˆ›å»ºï¼‰
â””â”€â”€ ffmpeg_build/             # ç¼–è¯‘äº§ç‰©
    â”œâ”€â”€ .build_markers/       # å¢é‡æ„å»ºæ ‡è®°
    â”œâ”€â”€ bin/                  # å¯æ‰§è¡Œæ–‡ä»¶
    â”œâ”€â”€ lib/                  # åŠ¨æ€åº“
    â””â”€â”€ include/              # å¤´æ–‡ä»¶
```

## æ•…éšœæ’é™¤

### æ„å»ºå¤±è´¥

```bash
# å•çº¿ç¨‹æŸ¥çœ‹è¯¦ç»†é”™è¯¯
./build_mac.sh -j 1 -v

# å®Œå…¨æ¸…ç†åé‡è¯•
./build_mac.sh -c all -f
```

### æ‰¾ä¸åˆ°åŠ¨æ€åº“

```bash
# ä¸´æ—¶è®¾ç½®ç¯å¢ƒå˜é‡
source ./env_setup.sh -t

# æˆ–æ‰‹åŠ¨è®¾ç½®
export DYLD_LIBRARY_PATH="$(pwd)/ffmpeg_build/lib:$DYLD_LIBRARY_PATH"
```

### å¢é‡æ„å»ºæœªç”Ÿæ•ˆ

```bash
# æ£€æŸ¥æ„å»ºæ ‡è®°
ls -la ffmpeg_build/.build_markers/

# å¼ºåˆ¶é‡å»º
./build_mac.sh -f
```

## å¸¸è§é—®é¢˜

<details>
<summary><b>v2.0 ä¸ v1.0 çš„ä¸»è¦åŒºåˆ«ï¼Ÿ</b></summary>

- âœ… å¢é‡æ„å»ºèŠ‚çœæ—¶é—´
- âœ… å¹¶è¡Œç¼–è¯‘æå‡é€Ÿåº¦
- âœ… ç‰ˆæœ¬ç®¡ç†æ›´çµæ´»
- âœ… æ¨¡å—åŒ–æ¶æ„æ˜“ç»´æŠ¤
- âœ… Debugæ”¯æŒæ›´å®Œå–„
</details>

<details>
<summary><b>å¦‚ä½•æŒ‡å®šç‰¹å®šç‰ˆæœ¬ï¼Ÿ</b></summary>

ç¼–è¾‘ `config/versions.conf` è®¾ç½®å…·ä½“ç‰ˆæœ¬å·æˆ– commit hashï¼š
```bash
X264_VERSION="v0.164.3095"
X265_VERSION="3.5"
FFMPEG_VERSION="n6.0"
```
</details>

<details>
<summary><b>å¹¶è¡Œæ„å»ºå®‰å…¨å—ï¼Ÿ</b></summary>

å®‰å…¨ã€‚ç³»ç»Ÿä¼šç®¡ç†ä¾èµ–å…³ç³»ï¼Œç¡®ä¿åº“æŒ‰æ­£ç¡®é¡ºåºæ„å»ºã€‚
</details>

<details>
<summary><b>å¦‚ä½•æ·»åŠ æ–°çš„åº“ï¼Ÿ</b></summary>

1. åœ¨ `scripts/libs/` åˆ›å»º `build_newlib.sh`
2. åœ¨ `scripts/parallel_builder.sh` ä¸­æ·»åŠ åˆ° GROUP_1
3. åœ¨ `config/versions.conf` ä¸­æ·»åŠ ç‰ˆæœ¬é…ç½®
</details>

## è®¸å¯è¯

æœ¬å·¥å…·éµå¾ª FFmpeg é¡¹ç›®è®¸å¯è¯ã€‚ç¬¬ä¸‰æ–¹åº“è®¸å¯è¯ï¼š

- FFmpeg: LGPL/GPL
- x264, x265: GPL
- fdk-aac: Fraunhofer License (éè‡ªç”±)
- lame: LGPL
- opus, vpx, aom: BSD

## å‚è€ƒèµ„æº

- [FFmpeg å®˜æ–¹æ–‡æ¡£](https://ffmpeg.org/documentation.html)
- [FFmpeg ç¼–è¯‘æŒ‡å—](https://trac.ffmpeg.org/wiki/CompilationGuide)
- [æäº¤Issue](../../issues)

---

**æ„å»ºæ—¶é—´é¢„ä¼°**: é¦–æ¬¡ 15-25åˆ†é’Ÿ | å¢é‡ 5-10åˆ†é’Ÿ | æ— å˜æ›´ 10ç§’
